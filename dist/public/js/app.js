"use strict";function keysrt(key,desc){return function(a,b){return desc?~~(a[key]<b[key]):~~(a[key]>b[key])}}function keygen(){return Math.round((new Date).valueOf()*Math.random())}var field_guide_app=angular.module("field_guide_app",["ui","ui.router","ngSanitize","youtube-embed","field_guide_controls","field_guide_filters"]);field_guide_app.config(function($stateProvider,$urlRouterProvider,$httpProvider,$locationProvider){function checkLoggedin($q,$timeout,$http,$location,$rootScope){var deferred=$q.defer();$http.get("/loggedin").success(function(user){"0"!==user?(console.log("this user successfully logged in",user),$rootScope.user=user,$timeout(deferred.resolve,0)):(console.log("welp, that flunked",user),$rootScope.userNote="You need to log in.",$timeout(function(){deferred.reject()},0),$location.url("/login"))}).error(function(err){console.log(err)})}$locationProvider.html5Mode(!0),$httpProvider.defaults.timeout=3e3,$urlRouterProvider.otherwise("/login"),$stateProvider.state("/login",{url:"/login{acct:(?:/[^/]+)?}",controller:"login",templateUrl:"partials/auth/login.html"}).state("report_public",{url:"/p/report/:test_id",controller:"reportPublic",templateUrl:"partials/app/report_public.html"}).state("report",{url:"/report/:test_id",controller:"reportPrivate",templateUrl:"partials/app/report_private.html",resolve:{loggedin:checkLoggedin}}).state("account",{url:"/account",controller:"account",templateUrl:"partials/app/account.html",resolve:{loggedin:checkLoggedin}}).state("default",{url:"/",controller:"overview",templateUrl:"partials/app/overview.html",resolve:{loggedin:checkLoggedin}}).state("overview",{url:"/overview",controller:"overview",templateUrl:"partials/app/overview.html",resolve:{loggedin:checkLoggedin}}).state("test",{url:"/edit/test/:test_id",controller:"test",templateUrl:"partials/app/test.html",resolve:{loggedin:checkLoggedin}}).state("run",{url:"/run/:_id",controller:"run",templateUrl:"partials/app/run.html",resolve:{loggedin:checkLoggedin}}).state("summary",{url:"/summary/:_id",controller:"summary",templateUrl:"partials/app/summary.html",resolve:{loggedin:checkLoggedin}}).state("summary.test",{templateUrl:"partials/app/summary_test.html"}).state("summary.task",{templateUrl:"partials/app/summary_task.html"})}),field_guide_app.factory("socket",function($rootScope){return{on:function(eventName,callback){socket.on(eventName,function(){var args=arguments;$rootScope.$apply(function(){callback.apply(socket,args)})})},emit:function(eventName,data,callback){socket.emit(eventName,data,function(){var args=arguments;$rootScope.$apply(function(){callback&&callback.apply(socket,args)})})},removeAllListeners:function(eventName,callback){socket.removeAllListeners(eventName,function(){var args=arguments;$rootScope.$apply(function(){callback.apply(socket,args)})})}}}),field_guide_app.directive("youtube",function($window){return{restrict:"E",scope:{height:"@",width:"@",videoId:"@"},template:"<div></div>",link:function(scope,element){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var player;$window.onYouTubeIframeAPIReady=function(){player=new YT.Player(element.children()[0],{playerVars:{autoplay:0,html5:1,theme:"light",modesbranding:0,color:"white",iv_load_policy:3,showinfo:1,controls:1},height:scope.height,width:scope.width,videoId:scope.videoid})}}}}).directive("scrollGlue",["$parse",function($parse){function unboundState(initValue){var activated=initValue;return{getValue:function(){return activated},setValue:function(value){activated=value}}}function oneWayBindingState(getter,scope){return{getValue:function(){return getter(scope)},setValue:function(){}}}function twoWayBindingState(getter,setter,scope){return{getValue:function(){return getter(scope)},setValue:function(value){value!==getter(scope)&&scope.$apply(function(){setter(scope,value)})}}}function createActivationState(attr,scope){if(""!==attr){var getter=$parse(attr);return void 0!==getter.assign?twoWayBindingState(getter,getter.assign,scope):oneWayBindingState(getter,scope)}return unboundState(!0)}return{priority:1,restrict:"A",link:function(scope,$el,attrs){function scrollToBottom(){el.scrollTop=el.scrollHeight}function onScopeChanges(){activationState.getValue()&&scrollToBottom()}function shouldActivateAutoScroll(){return el.scrollTop+el.clientHeight+1>=el.scrollHeight}function onScroll(){activationState.setValue(shouldActivateAutoScroll())}var el=$el[0],activationState=createActivationState(attrs.scrollGlue,scope);scope.$watch(onScopeChanges),$el.bind("scroll",onScroll)}}}]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function($timeout,$window,config){return{require:"ngModel",restrict:"A, C",link:function(scope,element,attrs,ngModel){function initMirror(){var mirrorStyle=mirrorInitStyle;mirrored=ta,taStyle=getComputedStyle(ta),angular.forEach(copyStyle,function(val){mirrorStyle+=val+":"+taStyle.getPropertyValue(val)+";"}),mirror.setAttribute("style",mirrorStyle)}function adjust(){var taHeight,taComputedStyleWidth,mirrorHeight,width,overflow;mirrored!==ta&&initMirror(),active||(active=!0,mirror.value=ta.value+append,mirror.style.overflowY=ta.style.overflowY,taHeight=""===ta.style.height?"auto":parseInt(ta.style.height,10),taComputedStyleWidth=getComputedStyle(ta).getPropertyValue("width"),"px"===taComputedStyleWidth.substr(taComputedStyleWidth.length-2,2)&&(width=parseInt(taComputedStyleWidth,10)-boxOuter.width,mirror.style.width=width+"px"),mirrorHeight=mirror.scrollHeight,mirrorHeight>maxHeight?(mirrorHeight=maxHeight,overflow="scroll"):minHeight>mirrorHeight&&(mirrorHeight=minHeight),mirrorHeight+=boxOuter.height,ta.style.overflowY=overflow||"hidden",taHeight!==mirrorHeight&&(ta.style.height=mirrorHeight+"px",scope.$emit("elastic:resize",$ta)),$timeout(function(){active=!1},1))}function forceAdjust(){active=!1,adjust()}var ta=element[0],$ta=element;if("TEXTAREA"===ta.nodeName&&$window.getComputedStyle){$ta.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var text=ta.value;ta.value="",ta.value=text;var mirrored,active,append=attrs.msdElastic?attrs.msdElastic.replace(/\\n/g,"\n"):config.append,$win=angular.element($window),mirrorInitStyle="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",$mirror=angular.element('<textarea tabindex="-1" style="'+mirrorInitStyle+'"/>').data("elastic",!0),mirror=$mirror[0],taStyle=getComputedStyle(ta),resize=taStyle.getPropertyValue("resize"),borderBox="border-box"===taStyle.getPropertyValue("box-sizing")||"border-box"===taStyle.getPropertyValue("-moz-box-sizing")||"border-box"===taStyle.getPropertyValue("-webkit-box-sizing"),boxOuter=borderBox?{width:parseInt(taStyle.getPropertyValue("border-right-width"),10)+parseInt(taStyle.getPropertyValue("padding-right"),10)+parseInt(taStyle.getPropertyValue("padding-left"),10)+parseInt(taStyle.getPropertyValue("border-left-width"),10),height:parseInt(taStyle.getPropertyValue("border-top-width"),10)+parseInt(taStyle.getPropertyValue("padding-top"),10)+parseInt(taStyle.getPropertyValue("padding-bottom"),10)+parseInt(taStyle.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},minHeightValue=parseInt(taStyle.getPropertyValue("min-height"),10),heightValue=parseInt(taStyle.getPropertyValue("height"),10),minHeight=Math.max(minHeightValue,heightValue)-boxOuter.height,maxHeight=parseInt(taStyle.getPropertyValue("max-height"),10),copyStyle=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];$ta.data("elastic")||(maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4,mirror.parentNode!==document.body&&angular.element(document.body).append(mirror),$ta.css({resize:"none"===resize||"vertical"===resize?"none":"horizontal"}).data("elastic",!0),ta.oninput="onpropertychange"in ta&&"oninput"in ta?ta.onkeyup=adjust:adjust,$win.bind("resize",forceAdjust),$win.bind("click",forceAdjust),scope.$watch(function(){return ngModel.$modelValue},function(){forceAdjust()}),scope.$on("elastic:adjust",function(){initMirror(),forceAdjust()}),$timeout(adjust),scope.$on("$destroy",function(){$mirror.remove(),$win.unbind("resize",forceAdjust)}))}}}}]),angular.module("field_guide_filters",["ngSanitize","ui","ui.router"]),angular.module("field_guide_controls",["ui","ui.router"]);